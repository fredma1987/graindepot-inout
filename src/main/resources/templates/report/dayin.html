<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:include="head::head(${title})">
</head>
<body>
<div th:replace="navbar::navbar"></div>
<iframe id="report" width=100% height=100% frameborder='no'
        style="height: 600px"
        noresize border=0 marginWidth=10 marginHeight=10
        src=""></iframe>


</body>
</html>


<script th:inline="javascript">
    var urlPrefix = "/graindepot-inout";
    var theTable;
    var g_userAddress = [[${userAddress}]];
    var g_billdate=[[${billdate}]];
    $(document).ready(function () {
        //TODO 入库每日汇总表从数据库取模板，暂时用的是通用模板
        $("#report").attr("src","/graindepot-report/ureport/preview?" +
            "_u=mysql:day-in.ureport.xml&billdate="+g_billdate+
        "&graindepotid="+g_userAddress.graindepotid)
    });


    function query(param) {
        theTable = $('#myTable').bootstrapTable({
            //数据来源（包括处理分页，排序，过滤） ，即url，action，接口，等等
            ajax: {
                url: urlPrefix + "/tempfile/list/page",
                data: param,
                type: "GET"
            },
            //sScrollY: 510,//表格高度
            columns: [
                {data: "tempname"},
                {data: "temppath"},
                {data: "groupname"},
                {data: "graindepotname"},
                {
                    data: "tempid",
                    render: function (data, type, row) {
                        return '<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">' +
                            '<a class="green" href="javascript:toEdit(' + data + ')"' +
                            ' title="编辑" ' +
                            '>' +
                            '<i class="icon-pencil bigger-130"></i>' +
                            '</a>' +
                            '<a class="blue" href="javascript:toShow(\'' + row.temppath + '\')"' +
                            ' title="预览" ' +
                            '>' +
                            '<i class="icon-eye-open bigger-130"></i>' +
                            '</a>' +
                            '</div>';

                    }
                }
            ]
        });
    }

    function searchTable() {
        theTable.destroy();
        query(getParam());
    }

    function getParam() {
        var param = {};
        param.grainid = $("#grainid").val();
        return param
    }

    function rest() {
        $("input").val("");
        $("select").val("");
        //触发change事件
        $("select").trigger("change");
        searchTable();
        //$("#city").find("option[value = '"+"']").attr("selected","selected");//jq改变select的选中值

    }


    function doDel() {
        console.log($('#myTable').bootstrapTable("getChecked"));
        var checkedList = $('#myTable').bootstrapTable("getChecked");
        if (checkedList.length == 0) {
            $.bootstrapBox.alert.init({message: "请选择需要删除的行"});
            return
        }
        $.bootstrapBox.confirm.init({
            message: "确认删除？",
            callback: function (result) {
                if (result) {
                    var ids = checkedList.map(function (curr) {
                        return curr.tempid
                    });
                    $.post(urlPrefix + "/tempfile/del", {ids: ids.join(",")}, function (result) {
                        $.bootstrapBox.alert.init({
                            message: result.message
                        });
                        $("#myTable").bootstrapTable("reload");
                    })

                }

            }
        });

    }

    function toAdd() {
        $.bootstrapBox.dialog.init({
            title: "新增打印模板",
            url: urlPrefix + "/tempfile/toEdit",
            width: $(window).width() * 0.6,
            height: $(window).height() * 0.5
        })
    }

    function toEdit(id) {
        $.bootstrapBox.dialog.init({
            title: "修改打印模板",
            url: urlPrefix + "/tempfile/toEdit?id=" + id,
            width: $(window).width() * 0.6,
            height: $(window).height() * 0.5
        })
    }

    function toShow(path) {
        //window.open("/ureport/"+path);
        window.open("/graindepot-report/ureport/designer?_u=mysql:"+path);
    }

    function toDesign() {
        window.open("/graindepot-report/ureport/designer");
    }

    function toSave(result) {
        $.bootstrapBox.dialog.close();
        $.bootstrapBox.alert.init({
            message: result.message
        });
        $("#myTable").bootstrapTable("reload")
    }

</script>
