<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:include="head::head(${title})">
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script  th:inline="javascript">

    </script>
</head>

<body>
<div>
    <div th:replace="navbar::navbar"></div>
    <div class="main-container-inner">
        <div class="main-content" id="main-content" style="float: left;margin-left:0px;width:100%">
            <div class="page-content" style="padding:10px 30px 0px">
                <div class="page-header">
                    <h1>
                        初始库存单
                        <small>
                            <i class="icon-double-angle-right"></i>

                        </small>
                    </h1>
                </div>
                <!-- /.page-header -->

                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->

                        <form class="form-horizontal" id="validation-form" role="form">
                            <div class="row">
                                <div class="col-xs-12 col-sm-4" style="border:1px solid #CCC;padding:3px;width:100%">
                                    <div style="width: 100%;height:100%;padding-left:20px;float: left">
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:70px;padding-left:0px"> 仓房号： </label>
                                                <div class="col-sm-4" style="width:150px;padding-left:0px">
                                                    <select id="storageid" name="storageid" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:80px;padding-left:0px"> 粮食品种：</label>
                                                <div class="col-sm-4" style="width:150px;padding-left:0px">
                                                    <select id="grainid" name="grainid" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:80px;padding-left:0px"> 粮食性质：</label>
                                                <div class="col-sm-4" style="width:150px;padding-left:0px">
                                                    <select id="grainattrid" name="grainattrid" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label> 收获年度： </label>
                                                <input type="text" id="producingyear" name="producingyear" style="width:50px"
                                                       placeholder=""/>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:90px;padding-left:0px"> 粮食等级：</label>
                                                <div class="col-sm-4" style="width:120px;padding-left:0px">
                                                    <select id="grade" name="grade" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label> 单价： </label>
                                                <input type="text" id="price" name="price" style="width:50px"
                                                       placeholder=""/>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label> 库存数量： </label>
                                                <input type="text" id="netweight" name="netweight" style="width:50px"
                                                       placeholder=""/>
                                            </div>
                                        </div>
                                        <hr style="margin-bottom:5px;margin-top:15px"/>
                                        <div id="gqitem1" style="display: none">
                                            <div th:replace="in/gqitem::gqitem1"></div>
                                        </div>
                                        <div id="gqitem2" style="display: none">
                                            <div th:replace="in/gqitem::gqitem2"></div>
                                        </div>
                                        <hr style="margin-bottom:5px;margin-top:15px"/>
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:70px;padding-left:0px"> 包装方式：</label>
                                                <div class="col-sm-4" style="width:100px;padding-left:0px">
                                                    <select id="packtype" name="packtype" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label> 总包数： </label>
                                                <input type="text" id="packcount" name="packcount" style="width:50px"
                                                       placeholder=""/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:70px;padding-left:0px"> 调入省份：</label>
                                                <div class="col-sm-4" style="width:100px;padding-left:0px">
                                                    <select id="fprovinceid" name="fprovinceid" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label class="col-sm-4 control-label no-padding-right" style="width:70px;padding-left:0px"> 市（州）：</label>
                                                <div class="col-sm-4" style="width:100px;padding-left:0px">
                                                    <select id="fcityid" name="fcityid" class="form-control">
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="float: left;padding-left: 10px">
                                                <label> 原产地： </label>
                                                <input type="text" id="soucearea" name="soucearea" style="width:100px"
                                                       placeholder=""/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label> 备注： </label>
                                                <input type="text" id="remark" name="remark" style="width:200px"
                                                       placeholder=""/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div style="float: left;padding-left: 10px">
                                                <label> 流水号： </label>
                                                <label id="billcode" style="color: red">暂无</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /span -->
                            </div>
                            <div class="row" style="float: right;padding-right: 12px">
                                <a class="btn btn-success" style="border: 0;width: 120px;" onclick="toFindInoutDetail(1)">
                                    <i class="icon-arrow-left icon-on-left"></i>
                                    前一单
                                </a>
                                <a class="btn btn-success" style="border: 0;width: 120px;" onclick="toFindInoutDetail(1)">
                                    <i class="icon-arrow-right icon-on-right"></i>
                                    后一单
                                </a>
                                <a class="btn btn-success" onclick="toSave()" style="border: 0;width: 120px;">
                                    <i class="icon-save"></i>
                                    保存
                                </a>
                                <a class="btn btn-success" style="border: 0;width: 120px;">
                                    <i class="icon-save"></i>
                                    审核
                                </a>
                                <a class="btn btn-success" style="border: 0;width: 120px;padding-left:10px">
                                    <i class="icon-undo"></i>
                                    取消
                                </a>
                            </div>
                        </form>
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.page-content -->
        </div>
        <!-- /.main-content -->
    </div>
    <!-- /.main-container-inner -->

</div>
<!-- /.main-container -->

<script  th:inline="javascript">
    var g_billid = [[${id}]];
    var g_item = [[${item}]];
    var g_userAddress = [[${userAddress}]];
    $(function ($) {
        initStorage();
        initGrain();
        initGrainattr();
        initGrade();
        initPacktype();
        initFprovince();
    });

    function initStorage() {
        $("#storageid").bootstrapSelect({
            url: '/graindepot-inout/selectorInout/storageByMap',
            type: 'GET',
            valueField: 'storageid',
            textField: 'storagename',
            onSelect: function (storageid, row) {
                if (storageid) {
                    $("#grainid").bootstrapSelect("setValue", row.defGrainID)
                }
            }
        });
    }
    function initGrain(defaultGrainid) {
        $("#grainid").bootstrapSelect({
            url: '/graindepot-base/selector/grainList',
            type: 'GET',
            valueField: 'grainid',
            textField: 'grainname',
            defaultValue: defaultGrainid,
            onSelect: function (grainid, row) {
                if (grainid >= 3 && grainid <= 6) {
                    $("#gqitem1").css("display", "block");
                    $("#gqitem2").css("display", "none");
                } else {
                    $("#gqitem1").css("display", "none");
                    $("#gqitem2").css("display", "block");
                }
            }
        });
    }
    function initPacktype() {
        var data = [{value: 1, text: "散装"}, {value: 2, text: "包装"}];
        $("#packtype").bootstrapSelect({
            data: data,
            valueField: 'value',
            textField: 'text',
            defaultValue: 1
        });
    }
    function initGrain() {
        $("#grainid").bootstrapSelect({
            url: '/graindepot-base/selector/grainList',
            type: 'GET',
            valueField: 'grainid',
            textField: 'grainname',
            onSelect:function(value){
               if(value>=3&& value<=6){
                   $("#gqitem1").css("display","block");
                   $("#gqitem2").css("display","none");
               }else{
                   $("#gqitem1").css("display","none");
                   $("#gqitem2").css("display","block");
               }
            }
        });
    }
    function initGrainattr() {
        $("#grainattrid").bootstrapSelect({
            url:  '/graindepot-base/selector/grainattrList',
            type: 'GET',
            valueField: 'grainattrid',
            textField: 'grainattrname'
        });
    }
    function initGrade(){
        var data = [{value: 1, text: "一等"}, {value: 2, text: "二等"}, {value: 3, text: "三等"}
            , {value: 4, text: "四等"}, {value: 5, text: "五等"}, {value: 6, text: "等外"}];
        $("#grade").bootstrapSelect({
            data: data,
            valueField: 'value',
            textField: 'text',
            defaultValue: 3
        });
    }

    function initFprovince() {
        $("#fprovinceid").bootstrapSelect({
            url: '/graindepot-base/selector/provinceList',
            type: 'GET',
            valueField: 'provinceid',
            textField: 'provincename',
            defaultValue: g_userAddress.provinceid,
            onSelect: function (provinceid, row) {
                if (provinceid) {
                    initFcity(provinceid)
                } else {
                    $("#fcityid").bootstrapSelect("empty");
                }
            }
        });
    }

    function initFcity(provinceid) {
        $("#fcityid").bootstrapSelect({
            url: '/graindepot-base/selector/cityList',
            type: 'GET',
            valueField: 'cityid',
            textField: 'cityname',
            defaultValue: g_userAddress.cityid,
            param: {provinceid: provinceid}
        });

    }

    function toSave() {
        $("#validation-form").bootstrapValidator('validate');//提交验证
        if ($("#validation-form").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
            debugger;
            var param = turnArrayToJson($('form').serializeArray());
            if (g_billid) {
                param.billid = g_billid;
            }
            param.groupid = g_userAddress.groupid;
            param.companyid = g_userAddress.companyid;
            param.graindepotid = g_userAddress.graindepotid;
            $.post("/graindepot-inout/onstorage/editInitonstrage", param, function (result) {
                if (result.success) {
                    g_billid = result.data.billid;
                    //保存质检信息
                    param.billid=g_billid;
                    $.post("/graindepot-inout/onstorage/editInoutInsp",param).then(function () {
                        $("#billcode").html(result.data.billcode);
                        $.bootstrapBox.alert.init({message: result.message})
                    })
                } else {
                    $.bootstrapBox.alert.init({message: "保存失败"})
                }
            });
        }
    }

    //根据查出的初始库存单初始化页面显示
    function initInout(inout) {
        $("#storageid").bootstrapSelect("setValue", inout.storageid);
        $("#grainid").bootstrapSelect("setValue", inout.grainid);
        $("#grainattrid").bootstrapSelect("setValue", inout.grainattrid);
        $("#producingyear").val(inout.producingyear);
        $("#grade").bootstrapSelect("setValue", inout.grade);
        $("#price").val(inout.price);
        $("#netweight").val(inout.netweight);
        $("#packtype").bootstrapSelect("setValue", inout.packtype);
        $("#packcount").val(inout.packcount);
        $("#fprovinceid").bootstrapSelect("setValue", inout.fprovinceid);
        $("#fcityid").bootstrapSelect("setValue", inout.fcityid);
        $("#soucearea").val(inout.soucearea);
        $("#remark").val(inout.remark);
        $("#billcode").html(inout.billcode);
    }
    //type 1:前一单  3:后一单
    function toFindInoutDetail(flag) {
        var billid = g_billid;
        findInout(billid, flag);
    }
    function findInout(billid, flag) {
        $.get("/graindepot-inout/onstorage/findInitonstorage", {billid: billid, flag: flag})
            .then(function (result) {
                if (result.success) {
                    var inout = result.data;
                    g_billid = result.data.billid;
                    initInout(inout);
                }
                $.bootstrapBox.alert.init({message: result.message})
            }, function () {
                $.bootstrapBox.alert.init({message: "查询失败"})
            })
    }
</script>
</body>
</html>